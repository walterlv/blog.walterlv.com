@page "/post/{pagePath}"

@using System.Net
@using System.Net.Http
@using Walterlv.Blog.Data
@inject PostGenerator PostGenerator
@inject PostStaticRedirector Static
@inject SiteAnalytics Analytics

@if (title == null)
{
    <p><em>正在下载博客...</em></p>
}
else
{
    <Announcement></Announcement>

    <article class="post-content">
        <h1>@title</h1>
        <TimeMetadata PublishTime="@metadata.PublishTime" UpdateTime="@metadata.UpdateTime" />
        @postContent
        <p>本文会经常更新，请阅读原文：<a href="https://blog.walterlv.com/post/@metadata.Id">https://blog.walterlv.com/post/@metadata.Id</a>，以避免陈旧错误知识的误导，同时有更好的阅读体验。</p>
        <p>如果你想持续阅读我的最新博客，请点击 <a href="https://blog.walterlv.com/feed.xml">RSS 订阅</a>，或者<a href="https://walterlv.blog.csdn.net/">前往 CSDN 关注我的主页</a>。</p>
        <p>
            <a rel="知识共享许可协议" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                <img alt="知识共享许可协议" src="@Static.Host/img/by-nc-sa.svg" />
            </a>
            本作品采用
            <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>
            进行许可。欢迎转载、使用、重新发布，但务必保留文章署名
            <strong>吕毅</strong>
            （包含链接：
            <a href="https://blog.walterlv.com">https://blog.walterlv.com</a>
            ），不得用于商业目的，基于本文修改后的作品务必以相同的许可发布。如有任何疑问，请
            <a href="mailto:walter.lv@qq.com">与我联系 (walter.lv@qq.com)</a>
            。
        </p>
    </article>
}

<PostComment></PostComment>

@code {
    [Parameter]
    public string pagePath { get; set; }

    private string title;

    private Walterlv.Blog.Post metadata;

    private MarkupString postContent;

    protected override void OnInitialized()
    {
        string pageId = pagePath.EndsWith(".html", StringComparison.OrdinalIgnoreCase)
            ? pagePath.Substring(0, pagePath.Length - 5)
            : pagePath;
        try
        {
            var post = PostGenerator.Get(pageId);
            title = post.Title;
            metadata = post;
            postContent = new MarkupString(post.Content);
        }
        finally
        {
            Analytics.Handle($"/post/{pageId}", title);
        }
    }
}
